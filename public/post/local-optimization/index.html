<!DOCTYPE html><html lang="en-us" >

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.8.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Dylan O&#39;Connell">

  
  
  
    
  
  <meta name="description" content="WORK IN PROGRESS, scattered notes/plots here visualized, will be turned into proper post soon. Aims to explain in layman’s terms the way that the addition of noise can help gradient descent escape spurious optima (and how this has an intuitive interpretation in our own lives)">

  
  <link rel="alternate" hreflang="en-us" href="/post/local-optimization/">

  


  
  
  
  <meta name="theme-color" content="#E3E3DA">
  

  
  
  
  <script src="/js/mathjax-config.js"></script>
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css" integrity="sha256-4w9DunooKSr3MFXHXWyFER38WmPdm361bQS/2KUWZbU=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js" integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  




  


  
  

  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_32x32_fill_lanczos_center_2.png">
  <link rel="apple-touch-icon" type="image/png" href="/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_192x192_fill_lanczos_center_2.png">

  <link rel="canonical" href="/post/local-optimization/">

  
  
  
  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="og:site_name" content="Dylan&#39;s Blog">
  <meta property="og:url" content="/post/local-optimization/">
  <meta property="og:title" content="The Perils of Overly Local Optimization | Dylan&#39;s Blog">
  <meta property="og:description" content="WORK IN PROGRESS, scattered notes/plots here visualized, will be turned into proper post soon. Aims to explain in layman’s terms the way that the addition of noise can help gradient descent escape spurious optima (and how this has an intuitive interpretation in our own lives)"><meta property="og:image" content="/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_512x512_fill_lanczos_center_2.png">
  <meta property="twitter:image" content="/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_512x512_fill_lanczos_center_2.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2020-05-27T00:00:00&#43;00:00">
    
    <meta property="article:modified_time" content="2020-05-27T18:47:28-04:00">
  

  


    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/local-optimization/"
  },
  "headline": "The Perils of Overly Local Optimization",
  
  "datePublished": "2020-05-27T00:00:00Z",
  "dateModified": "2020-05-27T18:47:28-04:00",
  
  "author": {
    "@type": "Person",
    "name": "Dylan O'Connell"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "Dylan's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_192x192_fill_lanczos_center_2.png"
    }
  },
  "description": "WORK IN PROGRESS, scattered notes/plots here visualized, will be turned into proper post soon. Aims to explain in layman’s terms the way that the addition of noise can help gradient descent escape spurious optima (and how this has an intuitive interpretation in our own lives)"
}
</script>

  

  


  


  





  <title>The Perils of Overly Local Optimization | Dylan&#39;s Blog</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  







<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">Dylan&#39;s Blog</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">Dylan&#39;s Blog</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#posts"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>About</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#" aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      

      

    </ul>

  </div>
</nav>


  <article class="article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1>The Perils of Overly Local Optimization</h1>

  

  
    


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
          Last updated on
      
    
    May 27, 2020
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    16 min read
  </span>
  

  
  
  

  
  

</div>

    














  
</div>



  <div class="article-container">

    <div class="article-style">
      


<p>WORK IN PROGRESS, scattered notes/plots here visualized, will be turned into proper post soon. Aims to explain in layman’s terms the way that the addition of noise can help gradient descent escape spurious optima (and how this has an intuitive interpretation in our own lives)</p>
<div id="outline" class="section level1">
<h1>Outline</h1>
<ul>
<li><p>Note, this was openly inspired by the writings of Tim Harford. I ound his descriptiption of the London Tube Strike and its implications while struggling through the study of Langevin diffusions, and I had been meaning to try and show some visualizations of noisy optimization for a while. He’s a wonderful popular economics communicator, and a lot of fun to read.</p></li>
<li><p>In general, try and think of any and all images you can include! minimize text.</p></li>
</ul>
</div>
<div id="the-perfect-scrambled-eggs" class="section level1">
<h1>The Perfect Scrambled Eggs</h1>
<p>(or “our optimized lives”)</p>
<ul>
<li>[rw]My morning routine is perfectly optimized, a blend of art and science. I’ve settled on an order in which to take the ingredients for scrambled eggs, the exact selection of dishes to use to minimize washing, and the fact that my silver bowl has sides just low enough that beaten egg could escape, and that raw eggs go in the red bowl. I didn’t set out to figure this out, I just made scrambled eggs every morning for years, and over time saw tiny choices that make it go a little smoother.</li>
</ul>
<p>To add…</p>
</div>
<div id="disruption-and-the-london-subway-strike" class="section level1">
<h1>Disruption, and the London Subway Strike</h1>
<p>On February 4th, 2014, the workers of the London Tube (their underground subway), went on strike, forcing a number of station closures throughout the city. For three days, a subset of commuters found their usual routes to work blocked, and were forced to find alternatives. After the strike, the stations reopened, and life went back to normal.</p>
<p>But three economists saw the opportunity for a natural experiment: only certain commuters were disrupted by the closure, and using the tracking data collected by the Tube, their movements could be compared to the unaffected group. And surprisingly, life <em>didn’t</em> go right back to normal after the ending of the strike. The ID card data showed that some of the impacted group stuck with their newly discovered routes, and their commuting time decreased as a result.</p>
<p>The station closures forced commuters to break from their finely tuned routines, but a surprising number found themselves dragged unnwillingly along a route that proved faster than the one they had been taking for years. The economists even claim that on net, the strike decreased the total commuting time.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> Even if only a small fraction found new routes, their new route would benefit them for years to come, and taking this chance only required disruption for a couple of days.</p>
<p>This story provides a neat way to frame the mathematical challenge of optimization, and in particular, why so many optimization algorithms involve <em>random noise</em>, a choice which initially seems bizarre. I’ll begin by describing how to think about optimization in intuitive terms, and then detail how that corresponds with the common mathematical algorithms, and why the London Tube Strike provides a neat analogy to very real mathematical properties.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
</div>
<div id="the-mathematical-framework-of-optimization" class="section level1">
<h1>The Mathematical Framework of Optimization</h1>
<!-- This is duplicate with above? -->
<p>The purpose of this post is to show how this concept can be naturally articulated in a mathematical framework.<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> We are describing the challenge of optimization. Here’s a sample definition, from the <a href="https://deepai.org/machine-learning-glossary-and-terms/mathematical-optimization">DeepAI website</a>.</p>
<blockquote>
<p>Mathematical optimization is the process of maximizing or minimizing an objective function by finding the best available values across a set of inputs.</p>
</blockquote>
<ul>
<li>For London commuters, their “objective function” might be the duration of the commute,<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>, and the “available values across a set of inputs” might be the route they take.</li>
<li>If we want to find the highest peak in a mountain range (an example we’ll discuss in detail in the next section), the input might be the choice of latitude and longitude, and the objective the elevation at that point.</li>
<li>When baking chocolate chip cookies, the possible inputs might be the amount of each ingredient, and the order in which they are combined, and the objective function might be the tastiness of the resulting cookie. This isn’t quite a joke, Google once ran a <a href="https://static.googleusercontent.com/media/research.google.com/en//pubs/archive/46507.pdf">cookie optimization experiment</a> along these lines.<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a></li>
</ul>
<p>Optimization is vitally important in applied mathematics and statistics, but it can be quite hard. The vast increase in computational power has broadened our horizons for what optimization challenges are possible, but many useful problems remain out of our reach.</p>
<p>Generally, in optimization, we assume that we can check the value of the objective function at some chosen input. We can try a certain route on the subway and time the duration, we can bake a batch of cookies and eat them, and we will imagine that we have some computer which takes in latitude and longitude coordinates and spits out the altitude (this is called a “query” to the objective function, or perhaps “oracle”).</p>
<p>Our naive optimization strategy might be to just try a bunch of points. Maybe we can define a grid of latitude and longitude coordinates, check the elevation of each one, and pick the highest. But this naive approach only works when the potential choices of input are sufficiently narrow. In particular, we look at the “dimension” of the input space. Latitude and longitude represent a mere 2-dimensions. The number of points within an exhaustive “grid” of inputs grows exponentially with the dimension of the input. Cookies are comprised by some dozen ingredients. The famous Jacques Torres <a href="https://cooking.nytimes.com/recipes/1015819-chocolate-chip-cookies">cookie recipe</a> has <span class="math inline">\(12\)</span> ingredients. If we wanted to try all combinations of a mere five levels of each ingredient, that would be over two hundred thousand possibilities, which is a bit much for even the hungriest baker.</p>
<p>We are constantly confronting optimization challenges in our own life, and we rarely take this naive approach. Instead, we tend to look for small <em>local</em> optimizations, whose benefits we can easily identify.</p>
<!-- * Finding the best route on the subway is something we optimize. While often algorithmic services can do the work for us, in other cases (or the past), we have to figure it out ourselves, and we somehow pick our starting point. -->
<!-- * For an example, let's imagine we want to find the highest point in a mountain range. We can check an individual point, and see how high it is. How do we find the highest point? The analogy would be something like, instead of latitude and longitude in a mountain range, in our morning routine it would be that "series of choices for how we get to work".  -->
<!-- * Now, imagine instead of querying a computer for the height, you yourself were actually in that mountain range. What would you do? Well, you'd look for the peak, but what if you were in a forest? You'd go up. Specifically, you would look at the area around you for *local* guidance. -->
</div>
<div id="locality-in-optimization" class="section level1">
<h1>Locality in Optimization</h1>
<p>Imagine if we bite into a warm cookie, and the text the texture is just right, but there’s not enough chocolate.(more flowery language here?) We wouldn’t just throw up our hands and start from scratch… we’d add more chocolate! It’s hard to look at a cookie recipe, and imagine what the result will taste like. But we <em>can</em> taste a recipe, and imagine what a small tweak would taste like.</p>
<p>The “locality” in optimization refers to “closeness” in the input space. In latitude and longitude, this would be literal distance, while the definitions are a bit less cookie in the space of cookie ingredients and subway commutes. Broadly, we are pretty good at understanding. If we increase the amount of chocolate, we now they’ll taste a bit more chocolate-y than they do now. If we increase the amounts of chocolate, butter, baking soda, reduce the amount of flour, and tweak the balance between brown and cane sugar, are we confident we know what the result will taste like?</p>
<p>In the London Tube experiment, the researchers place some of the blame on the “stylized nature” of the Tube map displayed to commuters. Its spatial distortions make it difficult to spot major inefficiencies in their route, without some external push. By comparison, we can usually estimate the impact of these “local” changes by ourselves. If we get off one stop earlier, maybe our walk to work increases by a minute but we avoid the wait at a crowded station. These slight changes are a bit like increasing just a single ingredient in a cookie.</p>
<p><img src="london_tube_map.jpg" /></p>
<p>Personally, this describes my relationship with my own food. TO ADD MORE…</p>
<ul>
<li>In my own life, I find this with food all the time. I have a set rotation of dishes I love, that fit my criteria (hassle-free ingredients, saves well for leftoers, etc). I’m happy to make small chaanes to what I eat. I recently realized how well a lone, unadorned sweet potato went with some of my staples. That’s a one step addition, and I can evaluate its impact as I walk the aisles of the store. Sure enough, it quickly became a staple.</li>
<li>However, I’m sure there are many full dishes out there that would be just as good as my current rotation. But to find a new dish is a risk. There’s no way for me to see all the the links in the chain. Will the ingredients be easy to find? Will I find the cooking burdensome? What will the end result taste like? Are my cooking supplies well suited to the task?</li>
</ul>
<!-- * We provide some new rules of the game. We know not only the value at these points, we know the shape/slope/etc of the area around it. This is a reasonable relaxation, because we can estimate this shape by querying our computer for the values of the areas near our point (are we going up or down). The rule is that we can't look far away to see where the peak is (perhaps we're stuck in the Appalachian forests, and not the sheer granite of the Sierra Nevada).  -->
<!-- * This isn't arbitrary, it's a natural understanding of how we actually operate. We are inherently *local* optimizers. We can easily assess the impact of small changes, not not large ones. -->
<!-- * On a morning commute, we can estimate whether taking a turn a few blocks early to avoid a stoplight saves us time. It's much harder to figure out in advance whether taking the bus or train is easy. -->
<!-- * Now, I'd wager that generally, we're rather good at making small (later, we will call these "local", due to their geometric interpretation) adjustments. If I realize that by taking a right a few blocks early, I can avoid the long traffic light, I'll often do it.  -->
<!-- * However, there's a reason these are small changes. We can estimate their impact from where we are. If we considered an entirely new route to work, taking a whole different train line, we would have no way to know what that's like. -->
<p>Before, we imagined a challenge where we tried to find a peak of a mountain range, using a computer which could tell us the elevation of any chosen input point. Let’s imagine that it also tells us the slope of the incline at that point (“which direction is down”). This better reflects our intuition for local optimization, but it’s also not a large change to the game, because we could always simply query the elevation in a small area around our point, and gauge the slope ourselves. Imagine that we are hiking with an altimeter, and we can look around us and see the shape of the nearby slope. However, we can’t just look around and find a faraway peak, because we’re stuck in the forests of the Appalachians rather than the sheer granite ofthe Sierra Nevada. Our intuition tells us the optimization algorithm which is natural: from wherever we are, “go up”. This intuitive algorithm is called “gradient ascent”.</p>
</div>
<div id="gradient-ascent" class="section level1">
<h1>Gradient Ascent</h1>
<p>Here’s what gradient ascent looks like as a step-by-step process (although, its simplest summary is simply “go up”).</p>
<p>We begin at some initial point. We find the direction of steepest ascent from that point, i.e. up the hill (the magnitude and direction of steepest ascent form the “gradient” vector). Then, we walk for a period in that direction (the amount is determined by the “step size”, and how steep the ascent actually is). Once we finish walking, we are at a new point, and we repeat this process again (we determine direction of steepest ascent, and walk in that direction). Once we reach a point that is essentially flat, there is no more direction of steepest ascent to follow, and we are done (this is called “convergence”).</p>
<p>This is the intuitive definition of what it means to make <em>local</em> changes. Wherever we are, we think “what small change could we make to make this better?” If our cookies are too salty, we add a bit less salt, but we don’t start over from scratch.</p>
<div id="mathematical-definition" class="section level2">
<h2>Mathematical Definition</h2>
<!-- Some explanation of continuous vs discrete space would be nice? -->
<p>Imagine we are at some point <span class="math inline">\(x \in \mathbb{R}^d\)</span> (meaning, <span class="math inline">\(x\)</span> is a point in <span class="math inline">\(d\)</span>-dimensional space).
(Maybe in English first?)</p>
<p>Here’s a mathematical definition of a crude version of gradient descent.<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a></p>
<ol style="list-style-type: decimal">
<li>Let <span class="math inline">\(f: \mathbb{R}^d \to \mathbb{R}\)</span> be our objective function. Let <span class="math inline">\(\eta &gt; 0\)</span> be our scaling constant. We begin at some initial point <span class="math inline">\(x^{(0)} \in \mathbb{R}^d\)</span>. For <span class="math inline">\(k = 0, \ldots,\)</span>, until convergence, repeat steps 2 through 4(?).</li>
<li>Compute the gradient <span class="math inline">\(\nabla f(x^{(k)})\)</span>.</li>
<li>Set <span class="math inline">\(x^{(k+1)} \leftarrow x^{(k)} + \eta \nabla f(x^{(k)})\)</span>.</li>
<li>If <span class="math inline">\(\nabla f(x^{(k)})\)</span> is sufficiently small, halt the algorithm, and select <span class="math inline">\(x^{(k+1)}\)</span> as our optima. Otherwise, set <span class="math inline">\(k \leftarrow k+1\)</span>, and repeat steps 2-4.</li>
</ol>
<!-- http://timharford.com/2016/10/big-decision-ahead-just-roll-the-dice/ -->
</div>
<div id="visualizing-gradient-ascent" class="section level2">
<h2>Visualizing Gradient Ascent</h2>
<p>So, we follow the direction of steepest ascent, but what does that look like in practice? Our mountain range elevation challenge<a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a> provides a natural visualization. Imagine we are dealing with the simplest of all mountain ranges: a single hill. This one is perfectly round, for simplicitly, but we pretend we don’t know that, and we can only see the local area around us.
<!-- Need to go through and do better labels/etc for all these visualizations!  -->s
<!-- (Show the unimodel 2d case ) --></p>
<p>The following is a contour plot, like what you find on a topographical map.</p>
<p>It might be more clear if we consider viewing the map at an angle (thanks to the <code>rayshader</code> <a href="https://www.tylermw.com/3d-ggplots-with-rayshader/">package</a>.</p>
<p><img src="uni_vis_3d.png" /></p>
<p>Imagine we start at that red dot in the top right. We look around, and see that the direction of steepest ascent is down and to the left.</p>
<pre class="r"><code>eta.temp &lt;- 30
grad.first.step &lt;- GradBivarNormal(x.uni.init)
# Manually compute second step, for visualization
x.uni.2 &lt;- x.uni.init + eta.temp*grad.first.step

g.uni + uni.first.point + 
  geom_segment(aes(x = x.uni.init[1], y = x.uni.init[1],
                   xend = x.uni.2[1], yend = x.uni.2[2]),
               col = &quot;red&quot;, size = .25,
               arrow = arrow(length = unit(.2, &quot;cm&quot;), type = &quot;closed&quot;))</code></pre>
<p><img src="/post/2020-05-27-local-optimization.en/index_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>We move that distance up the slope, and look around once again. We see that the direction of steepest ascent is once again, down and to the left, and we move once more.</p>
<p>We can again try and picture this movement in 3D (which is admittedly hard to draw…).</p>
<p><img src="uni_vis_3d_step2.png" />
We repeat this process until we look around for that direction of steepest ascent, and see that we’re at a point which is basically flat. We can picture the whole process in the gif below. We start in the top right, and climb and climb until we reach the top of the mountain, where we stop.</p>
<!-- ```{r, include = FALSE} -->
<!-- g.uni <- tb.uni %>%  -->
<!--   ggplot(aes(x = x, y = y)) + -->
<!--   geom_tile(aes(fill = z)) + -->
<!--   geom_contour(aes(z = z), bins = 15, color = "black") + -->
<!--   scale_fill_gradientn("z", colours = terrain.colors(10)) + -->
<!--   coord_fixed() -->
<!-- g.uni -->
<!-- ``` -->
<p><img src="2d_uni_grad_ascent_anim.gif" />
<!-- THIS angle isn't very good, will have to adjust --></p>
</div>
</div>
<div id="not-all-mountains-are-friendly" class="section level1">
<h1>Not All Mountains Are Friendly</h1>
<p>In this simple example, our local minimization strategy (“just go up!”) finds the highest peak without any trouble. However, not all mountain ranges are quite so friendly. Imagine there were three different peaks, of differing heights. It’s a bit harder to picture, but there’s a 3D visualization after the contour plot to help.</p>
<pre class="r"><code># Basic plot of the setup
g.mix &lt;- tb.grid %&gt;% 
  ggplot(aes(x = x, y = y)) +
  geom_tile(aes(fill = z)) +
  geom_contour(aes(z = z), bins = 15, color = &quot;black&quot;) +
  ylim(-7.5,7.5) + xlim(-7.5, 7.5) +
  xlab(&quot;East/West&quot;) + ylab(&quot;North/South&quot;) +  
  scale_fill_gradientn(&quot;Elevation&quot;, colours = terrain.colors(10)) +
  coord_fixed()
g.mix</code></pre>
<pre><code>## Warning: Removed 17500 rows containing non-finite values (stat_contour).</code></pre>
<pre><code>## Warning: Removed 17500 rows containing missing values (geom_tile).</code></pre>
<p><img src="/post/2020-05-27-local-optimization.en/index_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p><img src="mix_vis_3d.png" /></p>
<!-- * 3d view, to help get a sense of it. -->
<!-- ```{r, include = FALSE} -->
<!-- #par(mfrow = c(1, 2)) -->
<!-- # plot_gg(g, width = 7, height = 4, raytrace = FALSE, preview = TRUE) -->
<!-- # plot_gg(g, multicore = TRUE, raytrace = TRUE, width = 7, height = 4,  -->
<!-- #         scale = 300, windowsize = c(1400, 866),  -->
<!-- #         zoom = 0.6, phi = 30, theta = 30) -->
<!-- # plot_gg(g,  -->
<!-- #         raytrace = FALSE,  -->
<!-- #         preview = TRUE) -->
<!-- # plot_gg(g,  -->
<!-- #         multicore = TRUE,  -->
<!-- #         raytrace = TRUE, -->
<!-- #         zoom = 0.6,  -->
<!-- #         phi = 30,  -->
<!-- #         theta = 30) -->
<!-- # render_camera(zoom=0.5,theta=-30,phi=30) -->
<!-- # render_snapshot(clear = TRUE) -->
<!-- # Sys.sleep(0.2) -->
<!-- # render_snapshot(clear = TRUE) -->
<!-- ``` -->
<p>This poses an obvious problem for our algorithm. We hike up until we reach the top of a peak, look around, see that we can’t go up any further, and stop. But this could be true of <em>any</em> of the three peaks, and only the peak in the southeast is actually highest.</p>
<p>Let’s say we start near the center of this region, and follow our algorithm. We climb up south and to the east, and reach that highest peak, same as we did in the case of a single hill.</p>
<pre class="r"><code>steps &lt;- 130
x.asc.seq &lt;- matrix(rep(NA, 2*steps), ncol=2)
# This is the starting position which takes us to the optima
x.asc.seq[1,] &lt;- c(1, -0.5)
grad.seq &lt;- matrix(rep(NA, 2*steps), ncol=2)
eta &lt;- 20


for (i in 1:(steps-1)) {
  grad.seq[i,] &lt;- GradMixtureNormal(x.asc.seq[i,])
  x.asc.seq[i+1,] &lt;-  x.asc.seq[i,] + grad.seq[i,]*eta
}

tb.mix.asc &lt;- tibble(x = x.asc.seq[,1], 
                     y = x.asc.seq[,2],
                     grad.x = grad.seq[,1],
                     grad.y = grad.seq[,2],
                     iter = 1:steps) %&gt;% 
  mutate(x.next = x + grad.x*eta,
         y.next = y + grad.y*eta)</code></pre>
<p><img src="2d_mix_grad_ascent_optima_anim.gif" /></p>
<p>However, what if our starting position was just a bit further north? Well, we’d head off in the opposite direction, and end up at the northmost peak. We’d halt at the top, unable to climb any further, and be forever stuck at a lower point than the peak in the southeast. And by the rules of our game, we can only see the area around us, and we’ll never know that there’s a higher peak elsewhere. And most crucially, we couldn’t possibly tell the difference between the two starting points, without prior knowledge of the shape of the region.</p>
<p><img src="2d_mix_grad_ascent_anim.gif" /></p>
<div id="the-perils-of-nonconvexity" class="section level2">
<h2>The Perils of “Nonconvexity”</h2>
<p>This simplified example illustrates a fundamental divide in mathematical optimization. If a shape is “convex”, we can easily compute its optima. If it is “nonconvex”, then it may be extremely difficult. Intuitively, we call a region “convex” if the line between any two points within that region stays <em>within</em> that region. Thus, the rectangular Wyoming is convex, while Cape Cod makes Massachussetts nonconvex. Then, we call a <em>function</em> “convex” if the region that lies above the surface of the function forms a convex set.</p>
<ul>
<li><p>Which optimization challenges are hard? Math draws a fairly simple distinction. <a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a></p></li>
<li><p>In short, in the convex realm, local information provides global guidance. The local slope is pointing us in a direction</p></li>
<li><p>Description of convex vs non-convex optimization, why they are two fundamentally different challenges.</p></li>
</ul>
</div>
</div>
<div id="embracing-random-noise" class="section level1">
<h1>Embracing Random Noise</h1>
<ul>
<li>The explanation of the noise step.</li>
</ul>
</div>
<div id="sgd-and-neural-nets" class="section level1">
<h1>SGD, and Neural Nets</h1>
<ul>
<li>We have seen randomization introduced quite literally, by a random movement. But randomization is often introduced less explicitly into popular algorithms.</li>
<li>Neural networks are the much heralded staple of the rise of machine learning. Their optimization, perhaps consistent of millions or billions of dimensions (we considered a <em>single</em> dimension for visualization purposes above)</li>
<li>Microsoft boasted of a neural network with <a href="https://www.microsoft.com/en-us/research/blog/zero-deepspeed-new-system-optimizations-enable-training-models-with-over-100-billion-parameters/">17 billion(!)</a> parameters, each of which are a dimension to be optimized.</li>
<li>The result is an enormous amount of potential spurious optima.</li>
<li>What we’ve found over the past decade, SGD works “unreasonably well”. It’s explicitly an algorithm for convex optimization, and yet it optimizes these deep networks.</li>
<li>There are a variety of complex answers, depending on who you ask, but the staple reason which dates back <a href="https://leon.bottou.org/publications/pdf/nimes-1991.pdf">decades</a> is that its inherent noisiness allows it to escape spurious local optima.<a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a> The noisiness comes not fro our explicit introduction, but from the its approximation error.</li>
<li>The noise of SGD has little analogy in our own lives, but the way that noise becomes a tool, not a hindrance, in non-convex optimization, is very real.</li>
</ul>
<p>SGD is the staple way to optimize neural networks.</p>
</div>
<div id="simulated-annealingthe-other-random-optimization-approaches" class="section level1">
<h1>Simulated Annealing/the other random optimization approaches?</h1>
</div>
<div id="wrapping-up" class="section level1">
<h1>Wrapping Up</h1>
<p>Of course, this is <em>hard</em>.</p>
<p>A pointed self help message would say to fine and embrace randomness. But with no such agenda, I can say that’s true, but also incredibly hard to get right</p>
<p>just look at the gif! this is all powerful theory, but hard to chose the right way to introduce noise. in a clean, mathematical scenario, we can study the sorts of noise that are optimal, without any cost. when it comes to our own personal life, we experience this noise as disruption.</p>
<p>The famous computer scientist Alan Perlis said “Optimization hinders evolution”, and it’s true. This is the fundamental “explore vs exploit” trade-off. We could spend our energy searching for better strategies (“explore”), or we could focus on deriving the benefit from the currently known optimal strategy (“exploit”). In almost every application, there is a trade-off, and it’s very hard to get right. I think our status quo bias and inherently “local” perspective means we’ll typically err on the side of spending too little time exploring, but of course it’s hard to know how to do that.</p>
<p>But the takeaway could be something as simple as welcoming disruption, rather than resisting it. There’s no point in getting mad at a change to your commute, the world won’t notice (cite quote?), but maybe you can use the simple platitude that this is the necessary phase of exploration.</p>
<p>Scrambled eggs are a wonderful way to start my morning. I doubt there’s much more room to optimize the way I enjoy them. But I’d be foolish to think that there weren’t wildly different options that were just as rewarding. [rw]</p>
<p><img src="test_grad_ascent_anim.gif" /></p>
<p><img src="test_noisy_ascent_anim.gif" /></p>
<!-- ```{r, include = FALSE} -->
<!-- # f <- function(x) { -->
<!-- #   (-x^2 + 3*x -2)*(x^2 -.5*x + 6) -->
<!-- # } -->
<!-- # x.seq <- seq(-10, 10, .1) -->
<!-- # plot(x.seq, f(x.seq)) -->
<!-- ``` -->
</div>
<div id="sources" class="section level1">
<h1>Sources</h1>
<ul>
<li><a href="http://timharford.com/books/messy/">“Messy”</a>, by Tim Harford.</li>
<li><a href="http://users.ox.ac.uk/~econ0360/FerdinandRauch/Tube.pdf">“The Benefits of Forced Experimentation: Striking
Evidence from the London Underground Network”</a>, by Larcom, Rauch, &amp; Willems (2017).</li>
<li>Short <a href="http://cep.lse.ac.uk/pubs/download/cp455.pdf">write-up</a> of the London Tube Strike research.</li>
<li><a href="https://static.googleusercontent.com/media/research.google.com/en//pubs/archive/46507.pdf">“Bayesian Optimization for a Better Dessert”</a>, by Kochanski et al. (2017).</li>
<li>The <a href="https://www.rayshader.com/"><code>rayshader</code> package</a>.</li>
</ul>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Albeit, this seems much harder to rigorously prove, than to simply cite the study as a neat thought experiment, like I’m doing here.<a href="#fnref1" class="footnote-back">↩</a></p></li>
<li id="fn2"><p>I have no personal insight into the rigor of the experiment itself, it’s being used just as a framing device here.<a href="#fnref2" class="footnote-back">↩</a></p></li>
<li id="fn3"><p>A rare, and extremely tenuous connection between areas of my research, and reality.<a href="#fnref3" class="footnote-back">↩</a></p></li>
<li id="fn4"><p>Or you could add in other factors, like cost and pleasantness.<a href="#fnref4" class="footnote-back">↩</a></p></li>
<li id="fn5"><p>I’ve tasted the resulting cookies, not bad for a cafeteria batch.<a href="#fnref5" class="footnote-back">↩</a></p></li>
<li id="fn6"><p>This is for an extremely crude version with fixed step size <span class="math inline">\(\eta\)</span>. There is no reason to use fixed step size in practice, but that adjustment isn’t relevant to the demonstration.<a href="#fnref6" class="footnote-back">↩</a></p></li>
<li id="fn7"><p>name this somehow?<a href="#fnref7" class="footnote-back">↩</a></p></li>
<li id="fn8"><p>Like maximization and minimization, convex and concave will be used interchangeably. The multiplying a convex function by minus <span class="math inline">\(1\)</span> makes it concave. Concave functions are easy to maximize, but we can switch between the two interchangeably.<a href="#fnref8" class="footnote-back">↩</a></p></li>
<li id="fn9"><p>And “saddle points”, which I am skirting past here, as they are a similar concern for this high level explanation.<a href="#fnref9" class="footnote-back">↩</a></p></li>
</ol>
</div>

    </div>

    





<div class="article-tags">
  
  <a class="badge badge-light" href="/tag/introductory/">introductory</a>
  
  <a class="badge badge-light" href="/tag/optimization/">optimization</a>
  
  <a class="badge badge-light" href="/tag/r/">R</a>
  
</div>



<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=/post/local-optimization/&amp;text=The%20Perils%20of%20Overly%20Local%20Optimization" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=/post/local-optimization/&amp;t=The%20Perils%20of%20Overly%20Local%20Optimization" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=The%20Perils%20of%20Overly%20Local%20Optimization&amp;body=/post/local-optimization/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=/post/local-optimization/&amp;title=The%20Perils%20of%20Overly%20Local%20Optimization" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="whatsapp://send?text=The%20Perils%20of%20Overly%20Local%20Optimization%20/post/local-optimization/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=/post/local-optimization/&amp;title=The%20Perils%20of%20Overly%20Local%20Optimization" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>












  
  





  
    
    
    
      
    
    
    
    <div class="media author-card content-widget-hr">
      
        
        <img class="avatar mr-3 avatar-circle" src="/author/dylan-oconnell/avatar%20copy_hu70a705bbf7383a13eea33bcd09c55f2e_17965_270x270_fill_q90_lanczos_center.jpg" alt="Dylan O&#39;Connell">
      

      <div class="media-body">
        <h5 class="card-title"><a href="/">Dylan O&#39;Connell</a></h5>
        
        
        <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
    <li>
      <a href="mailto:dylan.oconnell@yale.edu" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://twitter.com/DylanPOConnell" target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/dylan.potter.oconnell" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
</ul>

      </div>
    </div>
  












  
  
  <div class="article-widget content-widget-hr">
    <h3>Related</h3>
    <ul>
      
      <li><a href="/post/scraping-is2/">Scraping the &#34;Intelligence Squared&#34; Debate Results</a></li>
      
      <li><a href="/post/parlays-independence/">A Gentle Introduction to Parlays and Independence </a></li>
      
      <li><a href="/post/winning-debate/">Winning a Debate: Insights from &#34;Intelligence Squared&#34;</a></li>
      
    </ul>
  </div>
  




  </div>
</article>

      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/r.min.js"></script>
        
      

    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    <script>const isSiteThemeDark = false;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.37431be2d92d7fb0160054761ab79602.js"></script>

    






  
  
  <div class="container">
    <footer class="site-footer">
  
  <p class="powered-by">
    
      <a href="/privacy/">Privacy Policy</a>
    
    
       &middot; 
      <a href="/terms/">Terms</a>
    
  </p>
  

  <p class="powered-by">
    
  </p>

  
  






  <p class="powered-by">
    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
